# Lec - Raft

虽然 Raft 已经写完了，但是 Raft 还是得看看，因为有非常多搞不懂的东西。

最开始讲了一下多数投票系统，如果只是两个节点，那么就会有平票的情况发生，所以其实是无意义的，因为不知道哪个是对的。

所以出现了多数投票系统，假设有 5 个节点，那么只要有 3 个节点同意就可以了。

也就是你如果有 2 n + 1 个节点，那么也就有 n 个节点的容错能力。

只要收到 n + 1 个节点的同意就可以了，包括自己。

有一个点注意一下，就是别人的回复可能会有延迟，如果已经超过了 n + 1 个节点，别人的节点可能还在回复中，但是不需要管他。

接下来简单讲了一下 Raft 的基本架构。

总的来说，Raft 主要是有几个 RPC 进行通信。

首先是 Client 接收到请求之后，会把请求发送给 Leader 节点，然后 Leader 节点会把请求追加到自己的日志中，然后并行地把日志发送给 Follower 节点。

收到半数以上 Follower 节点的确认之后，Leader 节点就可以把日志应用到自己的状态机中，然后回复 Client，表示请求完成，然后再告诉 Follower 节点可以把日志应用到自己的状态机中。

讲完基本架构之后，才开始讲解 Leader Election。

早期的 Paxos 是没有 Leader 的概念的。

Follower 也不需要知道 Leader 是谁，只需要知道当前的任期号就可以了。

不可能存在完美的 Leader，即便 Leader 从来都不出错，也可能会因为网络问题导致新的 Leader 选举出来。

然后讲了一下 Leader Election 的过程，如果 S1 是 Leader，它在发送过程中可能因为网络问题断开了，这时候 Follower 节点就会在一段时间内没有收到 Leader 的心跳包，就会认为 Leader 挂掉了，然后就会开始选举新的 Leader。
